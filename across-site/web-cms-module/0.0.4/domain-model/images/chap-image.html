<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image model :: Across</title>
    <meta name="generator" content="Antora 1.0.0">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Across</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="web-cms-module" data-version="0.0.4">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Module: Web CMS</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">Creating a form</span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Module: Web CMS</span>
    <span class="version">0.0.4</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Across</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../across/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Application Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guides/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../migration/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Admin Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../admin-web-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Bootstrap UI</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../bootstrap-ui-module/2.0.1/index.html">2.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Documents & Forms</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../dynamic-forms-module/0.0.1/index.html">0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Entity Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../entity-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: LDAP Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../ldap-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - ACLs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../spring-security-acl-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Module: Web CMS</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">0.0.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../../../across/3.0.0/index.html" class="home-link"></a>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/ForeachOS/ax-docs-web-cms-module/edit/develop/docs/modules/ROOT/pages/domain-model/images/chap-image.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Image model</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>WebCmsModule provides an asset representing an image file.
The main entity is the <code>WebCmsImage</code> and you can use the <code>WebCmsImageRepository</code> to query the image entities.</p>
</div>
<div class="paragraph">
<p>WebCmsModule does not actually store the physical image data.
It routes all interactions with the physical files through a <code>WebCmsImageConnector</code> that is responsible for the connection with an image repository.
 The image repository is also expected to serve as CDN for rendering images in a browser.</p>
</div>
<div class="paragraph">
<p>The administration UI allows you to upload and select images in components.  Different utility functions are available to generate urls to the images for use in templates.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connecting_to_an_image_repository"><a class="anchor" href="#_connecting_to_an_image_repository"></a>Connecting to an image repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Out of the box, WebCmsModule has support for connecting to either <a href="http://cloudinary.com/">Cloudinary</a> or a <a href="https://repository.foreach.be/projects/image-server/4.0.0.RELEASE/reference/">Foreach ImageServer</a> image repository.</p>
</div>
<div class="sect2">
<h3 id="_cloudinary_connector"><a class="anchor" href="#_cloudinary_connector"></a>Cloudinary connector</h3>
<div class="paragraph">
<p>To connect to Cloudinary for your images you should add the Cloudinary dependency to your application and add the properties with the correct credentials.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>WebCmsModule will only store the image assets in your Cloudinary account and will generate optimized urls for rendering an image.
Previously existing assets will not be read from your Cloudinary account.</p>
</div>
</blockquote>
</div>
<div class="sect3">
<h4 id="_pom_xml"><a class="anchor" href="#_pom_xml"></a>pom.xml</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.cloudinary&lt;/groupId&gt;
    &lt;artifactId&gt;cloudinary-http44&lt;/artifactId&gt;
    &lt;version&gt;1.14.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_application_yml"><a class="anchor" href="#_application_yml"></a>application.yml</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">webCmsModule:
  images:
    cloudinary:
      enabled: true
      cloudName: yourCloudName
      apiKey: 123456789
      apiSecret: secret
      # Optionally specify additional settings
      settings:
        secure: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>When setting <strong>webCmsModule.images.cloudinary.enabled</strong> to <code>true</code>, WebCmsModule will create its own <code>Cloudinary</code> instance with the specified values.
If your application creates a <code>Cloudinary</code> bean manually however, there is no need to specify the properties as WebCmsModule will automatically detect it and create the corresponding <code>WebCmsImageConnector</code>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>When you delete a <code>WebCmsImage</code>, the corresponding image asset in your Cloudinary account will be deleted as well.
If you do not want this, you can manually create a <code>CloudinaryWebCmsImageConnector</code> with different settings.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_imageserver_connector"><a class="anchor" href="#_imageserver_connector"></a>ImageServer connector</h3>
<div class="paragraph">
<p>To connect to a remote ImageServer for your images you should add the ImageServer Client dependency to your application and add the properties with the correct credentials.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>WebCmsModule will only store the image assets in your ImageServer account and will generate optimized urls for rendering an image.
Previously existing assets will not be read from ImageServer.</p>
</div>
</blockquote>
</div>
<div class="sect4">
<h5 id="_pom_xml_2"><a class="anchor" href="#_pom_xml_2"></a>pom.xml</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.foreach.imageserver&lt;/groupId&gt;
    &lt;artifactId&gt;imageserver-client&lt;/artifactId&gt;
    &lt;version&gt;4.0.0.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_application_yml_2"><a class="anchor" href="#_application_yml_2"></a>application.yml</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">webCmsModule:
  images:
    imageServer:
      enabled: true
      url: "http://remote.imageserver.domain/resources/images"
      hashToken: optionalHashToken
      accessToken: secureApiAccessToken</code></pre>
</div>
</div>
<div class="paragraph">
<p>When not using a <strong>hashToken</strong>, retrieving the resolution <strong>0x0</strong> should be allowed in order to retrieve the original image.</p>
</div>
<div class="paragraph">
<p>When setting <strong>webCmsModule.images.imageServer.enabled</strong> to <code>true</code>, WebCmsModule will create its own <code>ImageServerClient</code> instance with the specified values.
If your application creates an <code>ImageServerClient</code> bean manually however, there is no need to specify the properties as WebCmsModule will automatically detect it and create the corresponding <code>WebCmsImageConnector</code>.</p>
</div>
<div class="paragraph">
<p>If your application is also the ImageServer (by running ImageServerCoreModule), there is no need to add the client dependency seperately or to specify any property credentials.
If you ensure the ImageServerCoreModule is configured to create a local client, it will be picked up automatically.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>When you delete a <code>WebCmsImage</code>, the corresponding image asset in your ImageServer will be deleted as well.
If you do not want this, you can manually create a <code>ImageServerWebCmsImageConnector</code> with different settings.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_custom_connector"><a class="anchor" href="#_using_a_custom_connector"></a>Using a custom connector</h3>
<div class="paragraph">
<p>You can easily create a connector for a different type of image store.  Simply provide a bean called <strong>webCmsImageConnector</strong> that implements <code>WebCmsImageConnector</code>.  The bean will be automatically detected by WebCmsModule and will be integrated with the <code>WebCmsImage</code> infrastructure.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rendering_images"><a class="anchor" href="#_rendering_images"></a>Rendering images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rendering images is done by generating an url to the image from the image repository.  This can be done directly through <code>WebCmsImageConnector</code> or by using the <code>WebCmsRenderUtilityService</code>.</p>
</div>
<div class="paragraph">
<p>The <a href="#">{doc-domain-model}.adoc#appendices-thymeleaf-dialect</a> has the <strong>\#wcm</strong> expression object to easily generate the url for a <code>WebCmsImage</code> in your Thymeleaf template.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_importing_images"><a class="anchor" href="#_importing_images"></a>Importing images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can easily import images by providing a resource location to the actual image file.</p>
</div>
<div class="paragraph">
<p>Any property of <code>WebCmsImage</code> can either refer the <strong>objectId</strong> (starting with <em>wcm:asset:image</em>) or be a resource location representing the image file.
If the latter, an object id will be generated and if no <code>WebCmsImage</code> with that object id can be found, the resource file will be uploaded.</p>
</div>
<div class="paragraph">
<p>Only if the resource location changes between import runs would a new image be uploaded, otherwise it is perfectly safe to re-run the import.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The ability to import images depends on the presence of the <code>WebCmsImageConnector</code> bean.
Because it is possible that a <code>WebCmsImageConnector</code> is only initialized late during the application bootstrap, data installers are best set to execute in the <code>AfterContextBootstrap</code> phase.</p>
</div>
</blockquote>
</div>
<div class="sect4">
<h5 id="_example_image_import_yaml"><a class="anchor" href="#_example_image_import_yaml"></a>Example image import yaml</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">#
# Example of importing image web components.
# The actual WebCmsImage of the components is specified by setting the
# image property to a resource location of the image file.
#
assets:
  component:
    custom-component:
      title: Custom container with Image member
      componentType: custom-type-with-image-member
      wcm:components:
        image:
          image: "file:./src/main/test-data/test-image.jpg"
    sample-image:
      title: Sample image of a deer
      componentType: image
      image: "classpath:installers/test-data/deer.jpg"
    sample-image-from-url:
      title: Sample image fetched from URL
      componentType: image
      image: "http://images.freeimages.com/images/large-previews/afa/black-jaguar-1402097.jpg"</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>All Spring resource locations are supported.  Take into account that URL resources using HTTPS will only work if the executing Java runtime has the required SSL certificates to connect to the remote host.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script src="../../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
